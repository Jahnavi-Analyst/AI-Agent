<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SABS Chatbot - Luna</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #e6f2ff;
      margin: 0;
      padding: 0;
    }

    #chat-container {
      max-width: 600px;
      margin: 30px auto;
      border-radius: 15px;
      background: #ffffff;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      border: 1px solid #dbe9f4;
    }

    #chat-header {
      background-color: #002147;
      color: white;
      padding: 20px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    #chat-header img {
      height: 80px;
    }

    #chat-history {
      height: 350px;
      overflow-y: auto;
      padding: 20px;
      border-bottom: 1px solid #ddd;
      display: flex;
      flex-direction: column;
    }

    .bot-message, .user-message {
      margin-bottom: 15px;
      padding: 12px 18px;
      border-radius: 15px;
      max-width: 80%;
      word-wrap: break-word;
      line-height: 1.5;
    }

    .bot-message {
      background-color: #f1f1f1;
      color: #333;
      align-self: flex-start;
    }

    .user-message {
      background-color: #d1e7ff;
      text-align: right;
      color: #004080;
      margin-left: auto;
    }

    .emoji {
      font-size: 20px;
      margin-left: 8px;
    }

    #input-area {
      display: flex;
      padding: 15px;
      gap: 10px;
      background-color: #f9f9f9;
    }

    #user-input {
      flex-grow: 1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button {
      padding: 10px 16px;
      border-radius: 8px;
      background-color: #002147;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #004080;
    }

    select {
      margin: 10px 20px;
      padding: 10px;
      border-radius: 6px;
      font-size: 15px;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .option-button {
      padding: 8px 12px;
      background-color: #002147;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    .option-button:hover {
      background-color: #004080;
    }

    a {
      color: #002147;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <div id="chat-header">
      <img src="https://www.careeradvicepoint.com/wp-content/uploads/2022/01/sabs-logo-1.png" alt="SABS Logo">
      <h2>SABS Virtual Assistant - Luna</h2>
    </div>

    <div id="chat-history"></div>

    <div style="text-align:center;">
      <label for="quick-options"><strong>Quick Help:</strong></label>
      <select id="quick-options">
        <option value="">-- Select --</option>
        <option value="about">About Us</option>
        <option value="courses">Courses</option>
        <option value="facilities">Facilities</option>
        <option value="Benefitsforstudents">Benefits for Students</option>
        <option value="admission">Admissions</option>
        <option value="events">Events</option>
        <option value="placements">Placements</option>
      </select>
    </div>

    <div id="input-area">
      <input type="text" id="user-input" placeholder="Type your message here...">
      <button id="send-btn">Send</button>
      <button id="voice-btn">ğŸ¤</button>
    </div>
  </div>

  <script>
    const mainOptions = [
      { label: 'ğŸ“š Academics', value: 'academics' },
      { label: 'ğŸ« Campus Life', value: 'campus' },
      { label: 'ğŸ–¼ï¸ Gallery & Events', value: 'events' },
      { label: 'ğŸ’¼ Placements', value: 'placements' },
      { label: 'ğŸ“ Contact Us', value: 'contact' },
      { label: 'ğŸ“š Course List', value: 'courselist'}
    ];

    const subOptions = {
      academics: ['ğŸ“Œ Admission Info', 'ğŸ“ Apply Online'],
      campus: ['ğŸ« About Us', 'ğŸ¢ Facilities', 'ğŸ“ Benefits for students'],
      events: ['ğŸ–¼ï¸ Latest Gallery', 'ğŸ“… Events'],
      placements: ['ğŸ’¼ Recruiters', 'ğŸ“Š Placements'],
      contact: ['ğŸ“ Phone / Email', 'ğŸŒ Visit Website'],
      courselist: ['ğŸ’» BCA', 'ğŸ“Š BBA', 'ğŸ’° BCom']

    };

    function addMessageToHistory(sender, message, avatar, className) {
      const chatHistory = document.getElementById("chat-history");
      const messageElement = document.createElement("div");
      messageElement.classList.add(className);
      messageElement.innerHTML = `<strong>${sender}:</strong> ${message} <span class="emoji">${avatar || ""}</span>`;
      chatHistory.appendChild(messageElement);
      chatHistory.scrollTop = chatHistory.scrollHeight;
    }

    function displayOptions() {
      const msg = document.createElement('div');
      msg.className = 'bot-message';
      msg.innerHTML = `ğŸ‘‹ Hi! I'm Luna, your assistant from SABS. How can I help you today?`;
      const optionsDiv = document.createElement('div');
      optionsDiv.className = 'options';
      mainOptions.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-button';
        btn.textContent = opt.label;
        btn.onclick = () => handleOptionClick(opt.value);
        optionsDiv.appendChild(btn);
      });
      msg.appendChild(optionsDiv);
      document.getElementById("chat-history").appendChild(msg);
    }

    function handleOptionClick(value) {
      addMessageToHistory("You", value, "", "user-message");
      const botMsg = document.createElement("div");
      botMsg.className = "bot-message";

      if (subOptions[value]) {
        botMsg.innerHTML = `Here's what I can help you with in <strong>${value}</strong>:`;
        const nestedOptions = document.createElement("div");
        nestedOptions.className = "options";
        subOptions[value].forEach(item => {
          const subBtn = document.createElement("button");
          subBtn.className = "option-button";
          subBtn.textContent = item;
          subBtn.onclick = () => handleFinalSelection(item);
          nestedOptions.appendChild(subBtn);
        });
        botMsg.appendChild(nestedOptions);
      } else {
        botMsg.textContent = `You've selected: ${value}. Redirecting you to relevant information...`;
      }

      document.getElementById("chat-history").appendChild(botMsg);
      document.getElementById("chat-history").scrollTop = document.getElementById("chat-history").scrollHeight;
    }

    function handleFinalSelection(item) {
  addMessageToHistory("You", item, "", "user-message");

  fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: item, language: "en" })
  })
    .then(response => response.json())
    .then(data => addMessageToHistory("Bot", parseLinks(data.response), data.avatar, "bot-message"))
    .catch(error => console.error("Error:", error));
}


    function parseLinks(text) {
      return text.replace(/(https?:\/\/[\w\-\.?&=\/#]+)/g, '<a href="$1" target="_blank">$1</a>');
    }

    function sendMessage() {
      const userMessage = document.getElementById("user-input").value.trim();
      if (userMessage === "") return;

      addMessageToHistory("You", userMessage, "", "user-message");

      fetch("/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: userMessage, language: "en" })
      })
        .then(response => response.json())
        .then(data => addMessageToHistory("Bot", parseLinks(data.response), data.avatar, "bot-message"))
        .catch(error => console.error("Error:", error));

      document.getElementById("user-input").value = "";
    }

    document.getElementById("send-btn").addEventListener("click", sendMessage);
    document.getElementById("user-input").addEventListener("keypress", function (event) {
      if (event.key === "Enter") sendMessage();
    });

    document.getElementById("voice-btn").addEventListener("click", function () {
      fetch("/voice")
        .then(response => response.json())
        .then(data => {
          addMessageToHistory("You", data.voice_text, "", "user-message");
          fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: data.voice_text, language: "en" })
          })
            .then(response => response.json())
            .then(data => addMessageToHistory("Bot", data.response, data.avatar, "bot-message"))
            .catch(error => console.error("Error:", error));
        });
    });

    document.getElementById("quick-options").addEventListener("change", function () {
      const value = this.value;
      if (value) {
        const msgMap = {
          about: "Tell me about your college",
          courses: "What courses do you offer?",
          facilities: "What facilities are available?",
          Benefitsforstudents: "What do students benefit from?",
          admission: "Tell me about admissions",
          events: "Show me the latest events and gallery",
          placements: "Tell me about your college placements"
        };
        document.getElementById("user-input").value = msgMap[value] || "";
        sendMessage();
        this.value = "";
      }
    });

    window.onload = function () {
      setTimeout(() => {
        displayOptions();
      }, 400);
    };
  </script>
</body>
</html>
